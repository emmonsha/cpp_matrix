## üìò –≠—Ç–∞–ø 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é ‚Äî –∫–∞–∫ –≤ –°, –Ω–æ –≤ —Å—Ç–∏–ª–µ C++

> üí° –¢—ã –∑–Ω–∞–µ—à—å `malloc`, `free`, `for`-—Ü–∏–∫–ª—ã.  
> –í C++ –µ—Å—Ç—å **–∞–Ω–∞–ª–æ–≥–∏**: `new`, `delete`, –Ω–æ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º ‚Äî –∏ —ç—Ç–æ **–∫–ª—é—á–µ–≤–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**.

---

### üîß 3.1. –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```bash
cd ~/cpp_matrix_project/src
touch constructors.cpp
touch destructors.cpp
```

---

### ‚úÖ 3.2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `constructors.cpp` ‚Äî –∫–∞–∫ `init()` –≤ –°, –Ω–æ –ª—É—á—à–µ

–û—Ç–∫—Ä–æ–π `constructors.cpp`:

```cpp
// src/constructors.cpp
#include "s21_matrix_oop.h"
#include <stdexcept>  // –¥–ª—è std::out_of_range

namespace s21 {

// === –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã ‚Äî –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—Ä–∏—Ü—ã ===

// 1. –ë–∞–∑–æ–≤—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: —Å–æ–∑–¥–∞—ë—Ç 3x3 –º–∞—Ç—Ä–∏—Ü—É
// –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫: S21Matrix mat;
S21Matrix::S21Matrix() : rows_(3), cols_(3) {
  AllocateMatrix();  // –í—ã–¥–µ–ª—è–µ–º –ø–∞–º—è—Ç—å ‚Äî –∫–∞–∫ malloc –≤ –°
}

// 2. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: S21Matrix mat(2, 3);
S21Matrix::S21Matrix(int rows, int cols) : rows_(rows), cols_(cols) {
  if (rows <= 0 || cols <= 0) {
    throw std::out_of_range("Rows and cols must be positive.");
  }
  AllocateMatrix();  // –í—ã–¥–µ–ª—è–µ–º –ø–∞–º—è—Ç—å
}

// 3. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: S21Matrix mat2 = mat1;
// –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ deep copy ‚Äî –∫–∞–∫ –µ—Å–ª–∏ –±—ã —Ç—ã –ø–∏—Å–∞–ª copy_matrix() –≤ –°
S21Matrix::S21Matrix(const S21Matrix& other)
    : rows_(other.rows_), cols_(other.cols_) {
  AllocateMatrix();      // –í—ã–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é –ø–∞–º—è—Ç—å
  CopyMatrix(other);     // –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ ‚Äî –∫–∞–∫ –≤ –°
}

// 4. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è: S21Matrix mat2 = std::move(mat1);
// "–ó–∞–±–∏—Ä–∞–µ—Ç" –ø–∞–º—è—Ç—å —É –¥—Ä—É–≥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
S21Matrix::S21Matrix(S21Matrix&& other) noexcept
    : matrix_(other.matrix_), rows_(other.rows_), cols_(other.cols_) {
  // –û–±–Ω—É–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –æ–±—ä–µ–∫—Ç ‚Äî –∫–∞–∫ –µ—Å–ª–∏ –±—ã —Ç—ã –æ–±–Ω—É–ª–∏–ª —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ—Å–ª–µ free
  other.matrix_ = nullptr;
  other.rows_ = 0;
  other.cols_ = 0;
}

// === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã ‚Äî –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ matrix.c ===

// AllocateMatrix() ‚Äî –∫–∞–∫ create_matrix_data() –≤ –°
void S21Matrix::AllocateMatrix() {
  // –í—ã–¥–µ–ª—è–µ–º –º–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π: –∫–∞–∫ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
  matrix_ = new double*[rows_];

  // –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –≤—ã–¥–µ–ª—è–µ–º –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª
  for (int i = 0; i < rows_; ++i) {
    matrix_[i] = new double[cols_]();  // () ‚Äî –æ–±–Ω—É–ª—è–µ—Ç –ø–∞–º—è—Ç—å
  }
  // –ê–Ω–∞–ª–æ–≥ –≤ –°:
  // matrix_ = (double**)malloc(rows_ * sizeof(double*));
  // for (int i = 0; i < rows_; i++)
  //     matrix_[i] = (double*)calloc(cols_, sizeof(double));
}

// CopyMatrix() ‚Äî –∫–∞–∫ deep_copy_matrix() –≤ –°
void S21Matrix::CopyMatrix(const S21Matrix& other) {
  for (int i = 0; i < rows_; ++i) {
    for (int j = 0; j < cols_; ++j) {
      matrix_[i][j] = other.matrix_[i][j];
    }
  }
  // –ö–∞–∫ –≤ –°:
  // for (int i = 0; i < rows; i++)
  //     for (int j = 0; j < cols; j++)
  //         dest->data[i][j] = src->data[i][j];
}

}  // namespace s21
```

---

### ‚úÖ 3.3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `destructors.cpp` ‚Äî –∫–∞–∫ `free()` –≤ –°

```cpp
// src/destructors.cpp
#include "s21_matrix_oop.h"

namespace s21 {

// –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
// –ö–∞–∫ –µ—Å–ª–∏ –±—ã —Ç—ã –≤—ã–∑–≤–∞–ª free_matrix() –≤ –° ‚Äî –Ω–æ –Ω–µ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é!
S21Matrix::~S21Matrix() {
  FreeMatrix();
}

// FreeMatrix() ‚Äî –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤ –°
void S21Matrix::FreeMatrix() {
  if (matrix_) {  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ nullptr ‚Äî –∫–∞–∫ –≤ –°
    for (int i = 0; i < rows_; ++i) {
      delete[] matrix_[i];  // –£–¥–∞–ª—è–µ–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É ‚Äî –∫–∞–∫ free(row)
    }
    delete[] matrix_;  // –£–¥–∞–ª—è–µ–º –º–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π ‚Äî –∫–∞–∫ free(matrix)
    matrix_ = nullptr;  // –û–±–Ω—É–ª—è–µ–º ‚Äî –∫–∞–∫ –≤ –°
  }
  // –ê–Ω–∞–ª–æ–≥ –≤ –°:
  // void free_matrix(Matrix* m) {
  //     for (int i = 0; i < m->rows; i++) free(m->data[i]);
  //     free(m->data);
  //     m->data = NULL;
  // }
}

}  // namespace s21
```

---

### ‚úÖ 3.4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –° vs C++

| –ó–∞–¥–∞—á–∞ | –í –° | –í C++ |
|-------|-----|--------|
| –°–æ–∑–¥–∞—Ç—å –º–∞—Ç—Ä–∏—Ü—É | `Matrix* m = create_matrix(3, 3);` | `S21Matrix m(3, 3);` |
| –û—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–∞–º—è—Ç—å | `free_matrix(m); free(m);` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ |
| –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å | `Matrix* copy = copy_matrix(orig);` | `S21Matrix copy = orig;` |
| –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å | –ù–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ | `S21Matrix m2 = std::move(m1);` |
| –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ | –°–µ–≥—Ñ–æ–ª—Ç | –ú–æ–∂–Ω–æ –±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ |
| –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ | –õ–µ–≥–∫–æ, –µ—Å–ª–∏ –∑–∞–±—ã–ª `free` | –ü–æ—á—Ç–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ ‚Äî RAII |

---

### üîç –ü—Ä–∏–º–µ—Ä: RAII ‚Äî –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

–í –°:

```c
Matrix* m = create_matrix(1000, 1000);
if (some_error) {
    return;  // –£—Ç–µ—á–∫–∞! –ü–∞–º—è—Ç—å –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞
}
```

–í C++:

```cpp
S21Matrix m(1000, 1000);
if (some_error) {
    return;  // –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Üí –ø–∞–º—è—Ç—å —á–∏—Å—Ç–∞
}
```

> ‚úÖ **RAII (Resource Acquisition Is Initialization)** ‚Äî –∫–ª—é—á–µ–≤–∞—è –∏–¥–µ—è C++:  
> **–†–µ—Å—É—Ä—Å –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ, –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ.**

---

### ‚úÖ 3.5. –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –Ω–æ–≤–∏—á–∫—É

| –ö–æ–Ω—Ü–µ–ø—Ü–∏—è | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
|----------|-----------|
| `new` / `delete` | –ê–Ω–∞–ª–æ–≥ `malloc` / `free`, –Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä/–¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä |
| `new[]` / `delete[]` | –î–ª—è –º–∞—Å—Å–∏–≤–æ–≤ ‚Äî **–≤—Å–µ–≥–¥–∞ –ø–∞—Ä–Ω—ã–µ** |
| –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä | –ö–∞–∫ `init()` ‚Äî –Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä | –ö–∞–∫ `cleanup()` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç "—É–º–∏—Ä–∞–µ—Ç" |
| `nullptr` | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π `NULL` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ |
| `noexcept` | –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è move |
| `const` –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ | `const S21Matrix&` ‚Äî —Å—Å—ã–ª–∫–∞, –Ω–µ –∫–æ–ø–∏—è, –∏ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è |

---

### üìö –ß—Ç–æ –∏–∑—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

| –¢–µ–º–∞ | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –° |
|------|----------------|
| [RAII](https://en.cppreference.com/w/cpp/language/raii) | –ö–∞–∫ `init` + `cleanup`, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| [new/delete](https://en.cppreference.com/w/cpp/memory/new/operator_new) | `malloc` + `constructor` |
| [–î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä](https://en.cppreference.com/w/cpp/language/destructor) | `free`, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| [–°—Å—ã–ª–∫–∏ (`&`)](https://en.cppreference.com/w/cpp/language/reference) | –ö–∞–∫ —É–∫–∞–∑–∞—Ç–µ–ª–∏, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, –Ω–µ `NULL` |
| [Move semantics](https://stackoverflow.com/questions/3106110/what-are-move-semantics) | –ö–∞–∫ "–ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è" –ø–∞–º—è—Ç–∏ ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ |

---

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:

```bash
ls -l constructors.cpp destructors.cpp
```

---

‚úÖ **–≠—Ç–∞–ø 3 –∑–∞–≤–µ—Ä—à—ë–Ω.**  
–¢–µ–ø–µ—Ä—å —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å:
- –ö–∞–∫ **—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –≤ C++ –ø—Ä–æ—â–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ**, —á–µ–º –≤ –°.
- –ß—Ç–æ **–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä** ‚Äî –∫–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ `init` –∏ `free`.
- –ß—Ç–æ **RAII** ‚Äî –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ—Ç–∏–≤ —É—Ç–µ—á–µ–∫.

---

- [–ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](README.md)
- [üìò –≠—Ç–∞–ø 4: –ì–µ—Ç—Ç–µ—Ä—ã, —Å–µ—Ç—Ç–µ—Ä—ã –∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî –∫–∞–∫ –≤ –°, –Ω–æ —É–¥–æ–±–Ω–µ–µ](chapter4.md)